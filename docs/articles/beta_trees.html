<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Constructing a Beta-Tree Histogram • BetaTree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Constructing a Beta-Tree Histogram">
<meta property="og:description" content="BetaTree">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BetaTree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/beta_trees.html">Constructing a Beta-Tree Histogram</a>
    </li>
    <li>
      <a href="../articles/mode.html">Mode Hunting Using Beta-Trees</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Constructing a Beta-Tree Histogram</h1>
            
      
      
      <div class="hidden name"><code>beta_trees.Rmd</code></div>

    </div>

    
    
<p>First introduced by Pearson in 1895, the histogram is one of the
basic tools for summarizing and visualizing data. In order to construct
a histogram for univariate data, one first defines a set of “bins”
(i.e., intervals), and then counts the number of observations within
each bin. We can do the same for two- or higher- dimensional data.
However, as the dimension increases, creating a histogram becomes
challenging because of the <em>curse of dimensionality</em>. In essence,
if we use the same number of bins in each dimension, then in order to
have the same number of observations per bin as in the univariate
setting, the sample size needs to increase <em>exponentially</em> with
the dimension.</p>
<p>The Beta-tree histogram circumvents the curse of dimensionality by
adapting the histogram to the data. Instead of predefining the locations
of the bins, the Beta-tree histogram recursively partitions the space
according to the marginal <em>order statistics</em>. The Beta-tree
histogram has three properties:</p>
<ul>
<li><p>It <strong>adapts</strong> to where observations are
located.</p></li>
<li><p>It provides <strong>simultaneous</strong> confidence intervals
for the probability mass in each bin of the histogram.</p></li>
<li><p>It <strong>summarizes</strong> data succinctly by choosing the
largest bins such that data are close to uniform in each bin.</p></li>
</ul>
<p>The simultaneous confidence intervals (CI) created by the Beta-tree
histogram also allow us to perform various data-analytic tasks, such as
identifying modes in the underlying density. This is described in the
note “Identifying modes using a Beta-tree histogram”.</p>
<p>This document demonstrates how to use functions in the package to
create a Beta-tree histogram using data from of a mixture of
2-dimensional Gaussian distributions.</p>
<div class="section level2">
<h2 id="example-creating-a-beta-tree-histogram-for-2-dim-gaussian-data">Example: Creating a Beta-tree histogram for 2-dim Gaussian data<a class="anchor" aria-label="anchor" href="#example-creating-a-beta-tree-histogram-for-2-dim-gaussian-data"></a>
</h2>
<p>As an illustration, we create a Beta-tree histogram for a mixture of
two-dimensional Gaussian data (<span class="math inline">\(n =\)</span>
2000) sampled from the following distribution and visualized below:</p>
<p><span class="math display">\[
\frac{2}{5} N\left(\left(\begin{matrix}-1.5
\\0.6\end{matrix}\right),\left(\begin{matrix}1 &amp; 0.5 \\ 0.5 &amp;
1\end{matrix}\right) \right) + \frac{3}{5} N\left(\left(\begin{matrix}2
\\-1.5\end{matrix}\right),\left(\begin{matrix}1 &amp; 0 \\ 0 &amp;
1\end{matrix}\right) \right),
\]</span></p>
<p><img src="beta_trees_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></p>
<p>We use the <code><a href="../reference/BuildHist.html">BuildHist()</a></code> function to create a Beta-tree
histogram. (If <code>plot = T</code>, then the function plots the
Beta-tree histogram if the data are two-dimensional. )</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildHist.html">BuildHist</a></span><span class="op">(</span><span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span>, plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="beta_trees_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Besides the data matrix <code>X</code>, we input two parameters: the
significance level <code>alpha = 0.1</code> and a multiple testing
correction method <code>method = "weighted_bonferroni"</code>. This
means that the confidence intervals that the histogram provides are
simultaneously valid for every region (i.e. bin) at confidence level
<code>1-alpha = 0.9</code>. The return value of the
<code>BuildHist</code> is a matrix describing each region in the
Beta-tree histogram. Each row represents one region, and this histogram
includes 24 regions. Let’s look at the first region in the
histogram:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>
<span class="co">#&gt; [1] -2.22632850 -0.54347284 -1.25794334 -0.29780477  0.06725478  0.03429477</span>
<span class="co">#&gt; [7]  0.11420576 31.00000000  6.00000000</span></code></pre></div>
<p>The columns provide the following information:</p>
<ul>
<li><p>the first two columns are the lower bounds in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>-coordinates for this region; the next
two columns are the upper bounds in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>-coordinates for this region, i.e., this
rectangle is defined by the bounds [ -2.23 -1.26 ] *[ -0.54 -0.3 ]. If
the data have a higher dimension, then there would be correspondingly
more columns.</p></li>
<li><p>the fifth column stores the empirical density for this
region</p></li>
<li><p>the sixth and seventh columns store the lower and upper
confidence bound (CI) of the average probability density in the region.
With probability at least <span class="math inline">\((1-\alpha)\)</span>, the CIs cover the average
densities in all of the regions.</p></li>
<li><p>the eighth column stores the number of observations in this
region</p></li>
<li><p>the last column stores the depth of the region in the k-d tree,
which we will describe in the next section.</p></li>
</ul>
<p>The histogram above does not have a rectangular boundary. As we will
explain in the next few sections, this is because the histogram only
includes <strong>bounded</strong> regions. Alternatively, you can
initialize a bounding box for the histogram if you specify
<code>bounded = T</code>. You will then need to provide two additional
parameters <code>option</code> and <code>q</code> (which we will explain
in the next section). Below, we initialize the bounding box at the 0.05
and 0.95 quantiles in each dimension.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildHist.html">BuildHist</a></span><span class="op">(</span><span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span>, bounded <span class="op">=</span> <span class="cn">T</span>, 
                  option <span class="op">=</span> <span class="st">"qt"</span>, q<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.05</span><span class="op">)</span>, 
                  plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="beta_trees_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In the next section, we will describe how the Beta-tree histogram is
constructed.</p>
</div>
<div class="section level2">
<h2 id="how-a-beta-tree-histogram-is-constructed">How a Beta-tree histogram is constructed<a class="anchor" aria-label="anchor" href="#how-a-beta-tree-histogram-is-constructed"></a>
</h2>
<p>The Beta tree histogram is constructed in four steps:</p>
<ol style="list-style-type: decimal">
<li>Building a k-d tree.</li>
<li>Calculating confidence levels for every region.</li>
<li>Setting confidence bounds.</li>
<li>Select regions that pass a goodness-of-fit test.</li>
</ol>
<p>You can think of the algorithm as taking two passes: a top-down pass
partitioning the sample space into small regions and a bottom-up pass
selecting largest regions in which the observations are approximately
uniform.</p>
</div>
<div class="section level2">
<h2 id="building-a-k-d-tree">Building a k-d tree<a class="anchor" aria-label="anchor" href="#building-a-k-d-tree"></a>
</h2>
<p>The construction of the Beta-tree histogram starts by iteratively
partitioning the sample space along the marginal sample medians. This is
motivated by <a href="https://en.wikipedia.org/wiki/K-d_tree" class="external-link">k-d
trees</a>, which is a spatial-partitioning data structure for organizing
observations in a k-dimensional space.</p>
<p>In detail, we start with all of the observations (this is the root
node). At each step, we choose (1) an axis along which to partition and
(2) a location for partitioning. For (1), we iterate through all of the
coordinates, i.e., the first partition is along <span class="math inline">\(x\)</span>-axis and the second partition is along
the <span class="math inline">\(y\)</span>-axis etc. As to (2), we
partition along the sample <em>median</em> in the partitioning
coordinate.</p>
<p>In the two-dimensional example above, in the first partition, we
split the sample space into two half-spaces: <span class="math display">\[
R_1 = \{x\in\mathbb{R}^2:x_1&lt;X_{1,\lceil{n/2}\rceil} \}, \quad
R_2 = \{x\in\mathbb{R}^2:x_1&gt;X_{1,\lceil{n/2}\rceil} \}
\]</span> Note that the observations at the sample median are not
included in any of the two regions. In the second step, we split <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span> respectively. <span class="math inline">\(R_1\)</span> is split into two children <span class="math display">\[
R_3 = \{x\in R_1:x_2&lt;X^1_{2,\lceil{n_1/2}\rceil} \}, \quad
R_4 = \{x\in R_1:x_2&gt;X^1_{2,\lceil{n_1/2}\rceil} \},
\]</span> where <span class="math inline">\(X^1_{2,\lceil{n_1/2}\rceil}\)</span> is the <span class="math inline">\(\lceil{n_1/2}\rceil\)</span> order statistic in
the <span class="math inline">\(y\)</span>-coordinate for the
observations <span class="math inline">\(X^1\)</span> in <span class="math inline">\(R_1\)</span> (the total number of observations in
<span class="math inline">\(R_1\)</span> is <span class="math inline">\(n_1\)</span>). We continue splitting a region
until the number of observations inside is less than <span class="math inline">\(4\log n\)</span>, where <span class="math inline">\(n\)</span> is the total number of
observations.</p>
<p>The function <code>BuildKDTree</code> constructs a k-d tree.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildKDTree.html">BuildKDTree</a></span><span class="op">(</span><span class="va">X</span>, bounded <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>The <code>tree</code> object has two components: <code>kdtree</code>
and <code>nd</code>. The object <code>kdtree</code> stores the root node
of k-d tree as a list (you can refer to the function documentation for
more detail). We point out here that <code>leftchild</code> and
<code>rightchild</code> point to the two partitions of that region,
<code>low</code> ad <code>up</code> are the lower and upper bounds of
the region and <code>ndat</code> is the number of observations. The
following is one node in the tree:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">kdtree</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span>
<span class="co">#&gt; $leftchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rightchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ndat</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $depth</span>
<span class="co">#&gt; [1] 6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $low</span>
<span class="co">#&gt; [1] -1.257943 -1.249146</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $up</span>
<span class="co">#&gt; [1]  0.1291404 -0.1508506</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lower</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $upper</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bounded</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $leaf</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p><code>nd</code> contains the number of <em>bounded</em> regions at
depth <span class="math inline">\(d\)</span> of the tree (the root node
has depth = 0). This is useful when we adjust the confidence levels at
each depth to account for multiple CI. Here, at depth 4 there are 4
bounded regions.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">nd</span>
<span class="co">#&gt; [1]  0  0  0  0  4 12 36 21</span></code></pre></div>
<p>As you can see, there are no bounded regions in the first 4 levels.
You can initialize a bounding box with the option
<code>bounded = T</code> . This restricts the histogram construction to
the data inside the bounding box. We provide two options to specify the
bounding box:</p>
<ol style="list-style-type: decimal">
<li>If <code>option = 'qt'</code>, then we set the bounds at the sample
quantiles. For example, if <code>q = c(0.05, 0.05)</code>, then we
construct the bounding box <span class="math inline">\(R_0\)</span> as
follows: The vertical boundaries of <span class="math inline">\(R_0\)</span> are given by the 0.05 and 0.95
quantiles of the data in the x-coordinate. Denote the data that fall
strictly between these vertical boundaries by <span class="math inline">\(X^1\)</span>. The horizontal boundaries of <span class="math inline">\(R_0\)</span> are given by the 0.05 and 0.95
quantiles of <span class="math inline">\(X^1\)</span> in the y
coordinate. The root node <span class="math inline">\(R_0\)</span> is
the interior of this bounding box.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>If <code>option = 'ndat'</code>, then we specify the number of
observations rather than the quantiles. For example, if
<code>q = c(25, 25)</code>, then the vertical boundaries of <span class="math inline">\(R_0\)</span> have x-coordinates equal to the 25th
smallest and 25th largest x-coordinates of the data <span class="math inline">\(X\)</span>.</li>
</ol>
</div>
<div class="section level2">
<h2 id="calculating-confidence-levels-for-every-region">Calculating confidence levels for every region<a class="anchor" aria-label="anchor" href="#calculating-confidence-levels-for-every-region"></a>
</h2>
<p>We are able to construct exact CI for the probability content of
every region because the probability of a region <span class="math inline">\(R_k\)</span> satisfies</p>
<p><span class="math display">\[
F(R_k)\sim \mathrm{Beta}(n_k+1, n-n_k),
\]</span> where <span class="math inline">\(n_k\)</span> is the number
of observations in <span class="math inline">\(R_k\)</span> and <span class="math inline">\(n\)</span> is the total number of observations.
With this result, we can construct a <span class="math inline">\((1-\alpha)\)</span> confidence interval for the
average density <span class="math inline">\(f(R_k) =
F(R_k)/|R_k|\)</span>, where <span class="math inline">\(|R_k|\)</span>
denotes the volume of <span class="math inline">\(R_k\)</span>:</p>
<p><span class="math display">\[
\left(\frac{\mathrm{qBeta}(\frac{\alpha}{2},n_k+1, n-n_k)}{|R_k|},
\frac{\mathrm{qBeta}(1-\frac{\alpha}{2},n_k+1, n-n_k)}{|R_k|}\right).
\]</span></p>
<p>If we want to simultaneously cover all the regions at level <span class="math inline">\((1-\alpha)\)</span>, then we can redefine the
significance level for each region such that the total probability of
mis-coverage is at most <span class="math inline">\(\alpha\)</span>. For
example, we can use a <strong>weighted Bonferroni</strong> adjustment:
We assign the same level for every bounded region at the same tree
depth, and this significance level for regions at tree depth <span class="math inline">\(D\)</span> is defined as <span class="math inline">\(\alpha_D\)</span>,</p>
<p><span class="math display">\[
\hat{\alpha}_D = \frac{\alpha}{N_D (D_{\max} - D +
2)   \sum_{B=2}^{D_{\max}-D_{\min}+2}\frac{1}{B}},\quad D\geq D_\min
\]</span></p>
<p>Here, <span class="math inline">\(D_{\max}\)</span> is the maximum
depth of the k-d tree, <span class="math inline">\(D_{\min}\)</span> is
the smallest depth (greater than 0) at which there are bounded regions,
<span class="math inline">\(N_D\)</span> is the number of
<em>bounded</em> regions at depth <span class="math inline">\(D\)</span>, and the factor <span class="math inline">\(\sum_{B=2}^{D_{\max}-D_{\min} +
2}\frac{1}{B}\)</span> ensures that <span class="math inline">\(\hat{\alpha}_D\)</span> adds up to <span class="math inline">\(\alpha\)</span>.</p>
<p>The function <code>ConfLevel</code> computes <span class="math inline">\(\hat{\alpha}_D\)</span> for each depth <span class="math inline">\(D\)</span> and for a given overall level <span class="math inline">\(\alpha\)</span>. For example, the following code
computes <span class="math inline">\(\hat{\alpha}_D\)</span> when <span class="math inline">\(\alpha = 0.1\)</span>. You can also use an
unweighted Bonferroni adjustment by setting
<code>method = 'bonferroni'</code>. The unweighted Bonferroni adjustment
gives equal weight to each tree depth, and then equal weight to all
bounded regions at the same tree depth.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConfLevel.html">ConfLevel</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">nd</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span><span class="op">)</span>
<span class="va">ahat</span>
<span class="co">#&gt; [1] 0.0000000000 0.0000000000 0.0000000000 0.0000000000 0.0038961039</span>
<span class="co">#&gt; [6] 0.0016233766 0.0007215007 0.0018552876</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-confidence-bounds">Setting confidence bounds<a class="anchor" aria-label="anchor" href="#setting-confidence-bounds"></a>
</h2>
<p>Once we define the confidence levels, we compute simultaneous
confidence intervals for the average densities <span class="math inline">\(f(R_k)\)</span> as</p>
<p><span class="math display">\[
\left(\frac{\mathrm{qBeta}(\frac{\hat{\alpha}_D}{2}, n_k + 1,
n-n_k)}{|R_k|}, \frac{\mathrm{qBeta}(1 - \frac{\hat{\alpha}_D}{2}, n_k +
1, n-n_k)}{|R_k|}\right).
\]</span></p>
<p>In order to construct the Beta-tree histogram, we will use a
bottom-up pass to select the largest regions for which we are confident
that the observations inside are from a uniform distribution. We
implement this idea by picking the largest <span class="math inline">\(R_k\)</span> whose empirical density <span class="math inline">\(h_k = \frac{n_k + 1}{n|R_k|}\)</span> falls inside
the CIs of all of its children. These intersection bounds can be
computed recursively as</p>
<p><span class="math display">\[
\mathrm{lower}(R_k) =
\max\left(\frac{\mathrm{qBeta}(\frac{\hat{\alpha}_D}{2}, n_k + 1,
n-n_k)}{|R_k|}, \mathrm{lower}(\text{1st child}),
\mathrm{lower}(\text{2nd child})\right)\\
\mathrm{upper}(R_k) =
\min\left(\frac{\mathrm{qBeta}(1-\frac{\hat{\alpha}_D}{2}, n_k + 1,
n-n_k)}{|R_k|}, \mathrm{upper}(\text{1st child}),
\mathrm{upper}(\text{2nd child})\right)
\]</span></p>
<p>The function <code>SetBounds</code> computes these bounds. Let’s
compare to the same node in the k-d tree as before. Whereas the
<code>lower</code> and <code>upper</code> levels were empty before, the
two values are now filled in.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SetBounds.html">SetBounds</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">kdtree</span>, <span class="va">ahat</span>, <span class="va">n</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span>
<span class="co">#&gt; $leftchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rightchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ndat</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $depth</span>
<span class="co">#&gt; [1] 6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $low</span>
<span class="co">#&gt; [1] -1.257943 -1.249146</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $up</span>
<span class="co">#&gt; [1]  0.1291404 -0.1508506</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lower</span>
<span class="co">#&gt; [1] 0.005124354</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $upper</span>
<span class="co">#&gt; [1] 0.01741158</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bounded</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $leaf</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="selecting-regions-to-form-the-beta-tree-histogram">Selecting regions to form the Beta tree histogram<a class="anchor" aria-label="anchor" href="#selecting-regions-to-form-the-beta-tree-histogram"></a>
</h2>
<p>The function <code>SelectNodes</code> selects the largest regions
(w.r.t inclusion) such that the empirical density <span class="math inline">\(h_k\)</span> falls inside the interval <span class="math inline">\([\mathrm{lower}(R_k),
\mathrm{upper}(R_k)]\)</span>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">d</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> 
<span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SelectNodes.html">SelectNodes</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">B</span>, <span class="va">ahat</span>, <span class="va">n</span><span class="op">)</span></code></pre></div>
<p>Each row in the <code>hist</code> matrix represents one region in the
Beta-tree histogram. The matrix contains <span class="math inline">\(2\times d + 5\)</span> columns. The first <span class="math inline">\(2\times d\)</span> columns store the lower (first
<span class="math inline">\(d\)</span> columns) and upper bounds of the
region. The <span class="math inline">\((2d+1)\)</span> column stores
the empirical density <span class="math inline">\(h_k\)</span> and the
next two columns store the confidence interval of <span class="math inline">\(f(R_k)\)</span> as defined in the previous
section: <span class="math display">\[
\left(\frac{\mathrm{qBeta}(\frac{\hat{\alpha}_D}{2}, n_k + 1,
n-n_k)}{|R_k|}, \frac{\mathrm{qBeta}(1 - \frac{\hat{\alpha}_D}{2}, n_k +
1, n-n_k)}{|R_k|}\right).
\]</span></p>
<p>The last two columns store the number of observations inside the
region and its tree depth. The function <code>BuildHist</code> returns
<code>hist</code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Qian Zhao, Guenther Walther.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

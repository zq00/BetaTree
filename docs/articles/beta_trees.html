<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating a Beta Trees Histogram • BetaTrees</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating a Beta Trees Histogram">
<meta property="og:description" content="BetaTrees">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BetaTrees</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/beta_trees.html">Creating a Beta Trees Histogram</a>
    </li>
    <li>
      <a href="../articles/mode.html">Mode Hunting with Beta Trees</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating a Beta Trees Histogram</h1>
            
      
      
      <div class="hidden name"><code>beta_trees.Rmd</code></div>

    </div>

    
    
<p>First introduced by Pearson in 1895, a histogram is one of the basic
tools to summarize data. A histogram is created by defining a set of
rectangular “bins”, and then count the number of observations within
each bin. Below is an example of a one-dimensional histogram, where we
specify 15 bins in total. We can do the same in two- or higher-
dimensions. However, as the dimension increases, creating a histogram
becomes challenging because of what we call the curse of dimensionality.
In essense, if we include the same number of bins in each didimension,
then the number of bins we need to fill the whole space increase
<em>exponentially</em> as the number of dimension increases, and yet
most of these bins will be empty!</p>
<p>The Beta trees histogram circumvents the “curse of dimensionality” by
adapting the histogram to where the data locates. Instead of predefining
locations of bines, Beta trees histogram iteratively partitions the
space according to the <em>order statistics</em>. The Beta trees
histogram has three properties</p>
<ul>
<li><p><strong>Adapts</strong> to where observations are
located</p></li>
<li><p>Provides a <strong>simultaneous</strong> confidence interval of
the probability mass in each regions of the histogram</p></li>
<li><p><strong>Summarizes</strong> data succinctly by choosing the
largest bins such that data are relatively uniformly distributed inside
the region.</p></li>
</ul>
<p>The confidence intervals (CI) created by the Beta Trees histogram
also allows us to identify modes in the underlying density, which we
describe in another document “Identifying modes using a Beta Trees
histogram”.</p>
<p>This document demonstrates how to use functions in the package to
create a Beta-Trees histogram through an example of a mixture of
2-dimensional Gaussian distribution.</p>
<div class="section level2">
<h2 id="example-mixture-of-two-dimensional-gaussian-variables">Example: mixture of two dimensional Gaussian variables<a class="anchor" aria-label="anchor" href="#example-mixture-of-two-dimensional-gaussian-variables"></a>
</h2>
<p>As an illustration, we create a Beta Tree histogram for a mixture of
two-dimensional Gaussian data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">2000</span> <span class="co"># num of obs.</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># num of dim.</span></code></pre></div>
<p>The two-dimensional Gaussian are from the distribution below, and we
visualize the the samples of 2000 observations below.</p>
<p><span class="math display">\[
\frac{2}{5} \mathcal{N}\left(\left(\begin{matrix}-1.5
\\0.6\end{matrix}\right),\left(\begin{matrix}1 &amp; 0.5 \\ 0.5 &amp;
1\end{matrix}\right) \right) + \frac{3}{5}
\mathcal{N}\left(\left(\begin{matrix}2
\\-1.5\end{matrix}\right),\left(\begin{matrix}1 &amp; 0 \\ 0 &amp;
1\end{matrix}\right) \right),
\]</span></p>
<p><img src="beta_trees_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></p>
<p><code><a href="../reference/BuildHist.html">BuildHist()</a></code> function creates a Beta Tree histogram.
Here, we specify a confidence level <code>alpha = 0.1</code> and use
weighted bonferroni method for multiple testing correction. This implies
the following: the confidence interval satisfies that it is
simulatneously valid at confidence level <code>alpha = 0.1</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildHist.html">BuildHist</a></span><span class="op">(</span><span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span><span class="op">)</span></code></pre></div>
<p>The <code>hist</code> is a matrix describing each region in the
beta-tree histogram. Each row represents one region, and this histogram
includes 24 regions. Let’s look at the first region in the
histogram:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>
<span class="co">#&gt; [1] -2.56613342 -0.68129093 -1.40232246 -0.35586994  0.04224662  0.02154253</span>
<span class="co">#&gt; [7]  0.07173925 31.00000000  7.00000000</span></code></pre></div>
<p>and the columns provides the following information:</p>
<ul>
<li><p>the first two columns are the lower bounds in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>-coordinates of each region; the next
two columns are the upper bounds in <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>-coordinates of each region, i.e., this
rectangle is defined by the bounds [ -2.57 -1.4 ] *[ -0.68 -0.36
].</p></li>
<li><p>the fifth column stores the empirical density <span class="math inline">\(h(R)\)</span> in this region</p></li>
<li><p>the sixth and seventh columns store the lower and upper
confidence bound (CI) of the average probability density in the region.
With probability at least <span class="math inline">\((1-\alpha)\)</span>, the CI covers all the average
density in all of the regions.</p></li>
<li><p>the eighth column stores the number of observations <span class="math inline">\(n(R)\)</span> in this region</p></li>
<li><p>the last column stores the depth of the region in the k-d tree,
which we will describe in the next section.</p></li>
</ul>
<p>You can set two more parameters in the function: <code>plot</code>
and <code>bounded</code> . If <code>plot = T</code>, then the function
outputs a visualization Beta-trees histogram if the data is
two-dimensional.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildHist.html">BuildHist</a></span><span class="op">(</span><span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="beta_trees_files/figure-html/unnamed-chunk-7-1.png" width="480" style="display: block; margin: auto;"></p>
<p>As we will explain in the next few sections, the histogram only
includes <strong>bounded</strong> regions. If you select
<code>bounded = T</code>, then you can specify how to initialize a
rectangular bounded region. You will need to provide two additional
inputs <code>option</code> and <code>ndat</code> which we will explain
in the next section. In the example below, we ask to intialize the
region by choosing the 0.05 and 0.95 quantiles in each dimension.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildHist.html">BuildHist</a></span><span class="op">(</span><span class="va">X</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span>, bounded <span class="op">=</span> <span class="cn">T</span>, 
                  option <span class="op">=</span> <span class="st">"qt"</span>, q<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.05</span><span class="op">)</span>, 
                  plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="beta_trees_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In the next section, we will describe how the KD tree is
constructed.</p>
</div>
<div class="section level2">
<h2 id="creating-a-beta-tree-histogram">Creating a Beta Tree Histogram<a class="anchor" aria-label="anchor" href="#creating-a-beta-tree-histogram"></a>
</h2>
<p>We create a Beta Tree Histogram in four steps:</p>
<ol style="list-style-type: decimal">
<li>Constructing a k-d tree.</li>
<li>Calculating confidence levels.</li>
<li>Setting confidence bounds for every region.</li>
<li>Select regions that pass a goodness-of-fit test.</li>
</ol>
</div>
<div class="section level2">
<h2 id="constructing-a-k-d-tree">Constructing a k-d tree<a class="anchor" aria-label="anchor" href="#constructing-a-k-d-tree"></a>
</h2>
<p>A <a href="https://en.wikipedia.org/wiki/K-d_tree" class="external-link">k-d tree</a> is a
spatial-partitioning data structure for organizing observations in a
k-dimensional space. Motivated by the k-d tree, Beta trees histogram
starts by iteratively partitioning the sample space at the sample
median. In detail, we start with all of the observations (this is our
root node). At each step, we choose (1) an axis along which to partition
(2) a location for partitioning. For (1), we iterate through all of the
coordinates, i.e., the first partition is along <span class="math inline">\(x\)</span>-axis and the second partition is along
the <span class="math inline">\(y\)</span>-axis etc. For (2), we
partition along the sample <em>median</em> in the partitioning
coordinate.</p>
<p>In the two-dimensional example above, in the first partition, we
split the sample space into two half-spaces: <span class="math display">\[
R_1 = \{x\in\mathbb{R}^2:x_1&lt;X_{1,\left(\lceil{n/2}\rceil\right)} \},
\quad
R_2 = \{x\in\mathbb{R}^2:x_1&gt;X_{1,\left(\lceil{n/2}\rceil\right)} \}
\]</span> Note here that the obs. at the sample median is not included
in the two regions. In the second step, we split <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span> repsectively. <span class="math inline">\(R_1\)</span> is splitted into two children <span class="math display">\[
R_1 = \{x\in R_1:x_2&lt;X^1_{2,\left(\lceil{n_1/2}\rceil\right)}, X^1\in
R_1 \}, \quad
R_2 = \{x\in R_1:x_2&gt;X^1_{2,\left(\lceil{n_1/2}\rceil\right)}, X^1\in
R_1 \},
\]</span> where <span class="math inline">\(X^1\)</span> are all of the
observations in <span class="math inline">\(R_1\)</span>. We continue
splitting a region until the number of observations inside is less than
<span class="math inline">\(4\log n\)</span>, where <span class="math inline">\(n\)</span> is the total num of obs.</p>
<p>The function <code>BuildKDTree</code> constructs a k-d tree.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/BuildKDTree.html">BuildKDTree</a></span><span class="op">(</span><span class="va">X</span>, bounded <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>The <code>tree</code> object has two components <code>kdtree</code>
and <code>nd</code>. <code>kdtree</code> stores the k-d tree. You can
refer to the function documentation for the details, here we point out
that <code>leftchild</code> and <code>rightchild</code> points to the
two partitions of that node. For example, we can look at one node in the
tree.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">kdtree</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span>
<span class="co">#&gt; $leftchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rightchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ndat</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $depth</span>
<span class="co">#&gt; [1] 7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $low</span>
<span class="co">#&gt; [1] -1.4023225 -0.9135046</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $up</span>
<span class="co">#&gt; [1] -0.5857733 -0.1549037</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lower</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $upper</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bounded</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $leaf</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p><code>nd</code> contains the number of <em>bounded</em> regions at
each depth. This is useful when we adjust the confidence levels at each
depth to account for multiple CI. Here, at depth 5 there are 4 bounded
regions.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">nd</span>
<span class="co">#&gt; [1] NA NA NA NA  4 12 36 21</span></code></pre></div>
<p>As you can see, there are no bounded regions in the first 4 levels.
Because the histogram only includes bounded regions, many obs. not be
inlcuded in the final histogram. Alternatively, you can specify an
option <code>bounded = T</code> in the <code>BuildKDTree</code>
function. In that case, the function constructs the first two partitions
to initialize a bounded region. Here we provide two options to specify
the bounded region: (1) if <code>option = 'qt'</code>, then we partition
at the sample quantiles. For example, if <code>q = c(0.05, 0.05)</code>,
then the first partition defines a region <span class="math inline">\(R_0\)</span><br><span class="math display">\[
R_0 = \{x\in\mathbb{R}^2:X_{1,\left(\lceil{0.05 *
n}\rceil\right)}&lt;x_1&lt;X_{1,\left(n - \lceil{0.05 * n}\rceil\right)}
\},
\]</span> and the second partition defines a region <span class="math inline">\(R_1\)</span>, which we set as the root node. The
histogram above is created using</p>
<p><span class="math display">\[
R_1  = \{x\in R_0:X^0_{2,\left(\lceil{0.05 *
n_0}\rceil\right)}&lt;x_2&lt;X^0_{2,\left(n_0 - \lceil{0.05 *
n_0}\rceil\right)}, X^0\in R_0 \}
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>if <code>option = 'ndat'</code>, then we partition at the sample
order statistics. For example, if <code>q = c(25, 25)</code>, then the
partitions are at the order statistics 25 and <span class="math inline">\((n-25)\)</span> etc.</li>
</ol>
</div>
<div class="section level2">
<h2 id="calculating-confidence-levels">Calculating confidence levels<a class="anchor" aria-label="anchor" href="#calculating-confidence-levels"></a>
</h2>
<p>Theorem 1 in the paper states that the cumulative distributio
function in each region <span class="math inline">\(k\)</span> satisfies
<span class="math display">\[
F(R_k)\sim \mathrm{Beta}(n_k+1, n-n_k),
\]</span> and we can use this result to construct a <span class="math inline">\((1-\alpha)\)</span> confidence interval for the
average density <span class="math inline">\(f(R_k) =
F(R_k)/|R_k|\)</span> where <span class="math inline">\(|R_k|\)</span>
is the volume of <span class="math inline">\(R_k\)</span>.</p>
<p>This confidence interval is valid for only one region, and if we want
to achieve simultaneous coverage at level <span class="math inline">\((1-\alpha)\)</span>, we can adjust the confidence
level of each region such that the total probability of mis-coverage is
at most <span class="math inline">\(\alpha\)</span>. Here, we use a
<strong>weighted bonferroni</strong> adjustment, which defines the
confidence level for regions at level <span class="math inline">\(D\)</span> as <span class="math display">\[
\hat{\alpha}_D = \frac{\alpha}{(D_{\max} - D + 2) \times  N_D \times
\sum_{B=2}^{D_{\max}-2}\frac{1}{B}}.
\]</span> Here, <span class="math inline">\(D_{\max}\)</span> is the
maximum depth of the k-d tree, <span class="math inline">\(N_D\)</span>
is the number of <em>bounded</em> regions in depth <span class="math inline">\(D\)</span> and the factor <span class="math inline">\(\sum_{B=2}^{D_{\max}-2}\frac{1}{B}\)</span>
ensures that <span class="math inline">\(\hat{\alpha}_D\)</span> adds up
to <span class="math inline">\(\alpha\)</span>.</p>
<p><code>ConfLevel</code> computes <span class="math inline">\(\hat{\alpha}_D\)</span> at each level. For
example, the following code computes <span class="math inline">\(\hat{\alpha}_D\)</span> when <span class="math inline">\(\alpha = 0.1\)</span>. You can also use bonferroni
adjustment by setting <code>method = 'bonferroni'</code>. The Bonferroni
adjustment gives equal weight to every depth.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ConfLevel.html">ConfLevel</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">nd</span>, alpha <span class="op">=</span> <span class="fl">0.01</span>, method <span class="op">=</span> <span class="st">"weighted_bonferroni"</span><span class="op">)</span>
<span class="va">ahat</span>
<span class="co">#&gt; [1] 5.000000e-01 5.000000e-01 5.000000e-01 5.000000e-01 3.896104e-04</span>
<span class="co">#&gt; [6] 1.623377e-04 7.215007e-05 1.855288e-04</span></code></pre></div>
<p>, defined by <span class="math inline">\((n(R)+1)/ n / |R|\)</span>,
where <span class="math inline">\(n(R)\)</span> is the total num of obs.
inside the region, <span class="math inline">\(n\)</span> is the total
num of obs. and <span class="math inline">\(|R|\)</span> is the volume
of the rectangle.</p>
</div>
<div class="section level2">
<h2 id="setting-confidence-bounds-for-each-region">Setting confidence bounds for each region<a class="anchor" aria-label="anchor" href="#setting-confidence-bounds-for-each-region"></a>
</h2>
<p>Once we set the confidence levels, we can compute a simultaneous
confidence interval for the average density <span class="math inline">\(f(R_k)\)</span> at level <span class="math inline">\(\alpha\)</span> as</p>
<p><span class="math display">\[
\left(\frac{\mathrm{qBeta}(\hat{\alpha}_D, n_k + 1, n-n_k)}{|R_k|},
\frac{\mathrm{qBeta}(1 - \hat{\alpha}_D, n_k + 1, n-n_k)}{|R_k|}\right).
\]</span></p>
<p>To form the Beta Tree histogram, we will select regions whose
empirical density <span class="math inline">\(h_k = (n_k + 1)/n\)</span>
falls within the CI of all of its children. To simplify computation, we
set the lower and upper confidence bound in each node in the k-d tree
<code>tree</code> (in the <code>lower</code> and <code>upper</code> ) as
<span class="math display">\[
\mathrm{lower}(R_k) = \max\left(\frac{\mathrm{qBeta}(\hat{\alpha}_D, n_k
+ 1, n-n_k)}{|R_k|}, \mathrm{lower}(1st \mathrm{child}),
\mathrm{lower}(2nd \mathrm{child})\right)\\
\mathrm{upper}(R_k) = \max\left(\frac{\mathrm{qBeta}(1-\hat{\alpha}_D,
n_k + 1, n-n_k)}{|R_k|}, \mathrm{upper}(1st \mathrm{child}),
\mathrm{upper}(2nd \mathrm{child})\right)
\]</span></p>
<p><code>SetBounds</code> sets these two bounds. Compare the same node
in the k-d tree as before – the <code>lower</code> and
<code>upper</code> levels has been set.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SetBounds.html">SetBounds</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">kdtree</span>, <span class="va">ahat</span>, <span class="va">n</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">rightchild</span><span class="op">$</span><span class="va">leftchild</span><span class="op">$</span><span class="va">leftchild</span>
<span class="co">#&gt; $leftchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $rightchild</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ndat</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $depth</span>
<span class="co">#&gt; [1] 7</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $low</span>
<span class="co">#&gt; [1] -1.4023225 -0.9135046</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $up</span>
<span class="co">#&gt; [1] -0.5857733 -0.1549037</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lower</span>
<span class="co">#&gt; [1] 0.01103009</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $upper</span>
<span class="co">#&gt; [1] 0.04661584</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bounded</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $leaf</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="selecting-regions-to-form-the-beta-tree-histogram">Selecting regions to form the Beta Tree histogram<a class="anchor" aria-label="anchor" href="#selecting-regions-to-form-the-beta-tree-histogram"></a>
</h2>
<p><code>SelectNodes</code> selects the largest regions (w.r.t)
inclusion such that the empirical density <span class="math inline">\(h_k\)</span> falls inside the interval <span class="math inline">\([\mathrm{lower}(R_k),
\mathrm{upper}(R_k)]\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">d</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> 
<span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SelectNodes.html">SelectNodes</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">B</span>, <span class="va">ahat</span>, <span class="va">n</span><span class="op">)</span></code></pre></div>
<p>Each row in <code>hist</code> matrix represents one region in the
Beta Tree histogram. The matrix contains <span class="math inline">\(2\times d + 5\)</span> columns. The first <span class="math inline">\(2\times d\)</span> columns stores the lower (first
<span class="math inline">\(d\)</span> columns) and upper bounds of the
region. The <span class="math inline">\((2d+1)\)</span> column stores
the empirical density <span class="math inline">\(h_k\)</span> and the
next two columns store the confidence interval of <span class="math inline">\(f(R_k)\)</span> as defined in the previous
section: <span class="math display">\[
\left(\frac{\mathrm{qBeta}(\hat{\alpha}_D, n_k + 1, n-n_k)}{|R_k|},
\frac{\mathrm{qBeta}(1 - \hat{\alpha}_D, n_k + 1, n-n_k)}{|R_k|}\right).
\]</span></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Qian Zhao, Guenther Walther.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
